---
layout: post
title:  "メタプログラミング Ruby 第2版"
date:   2021-03-01 18:30:00 +0900
categories: book
---

# 第2章 月曜日：オブジェクトモデル

- インスタンスは複数のインスタンス変数とクラスへのリンクで構成されている。
- インスタンスのメソッドはオブジェクトのクラスに住んでいる。
  - クラスから見れば、それはインスタンスメソッドと呼ばれる。
- クラスはClassクラスのオブジェクトである。クラス名は単なる定数である。
- ClassはModuleのサブクラスである。モジュールは基本的にはメソッドをまとめたものである。それに加えてクラスは、`new`でインスタンス化したり、`supercclass`で階層構造を作ったりできる。
- 定数はファイルシステムのようなツリー状に配置されている。モジュールやクラスの名前がディレクトリ、通常の定数がファイルのようになっている。
- クラスはそれぞれBasicObjectまで続く継承チェーンを持っている。
- メソッドを呼び出すと、Rubyはレシーバーのクラスに向かって一歩右へ進み、それから継承チェーンを上へ向かって進んでいく。メソッドを発見するか継承チェーンが終わるまでそれは続く。
- クラスにモジュールをインクルードすると、そのクラスの継承チェーンの真上にモジュールが挿入される。モジュールをプリペンド(`prepend`)すると、そのクラス継承チェーンの真下にモジュールが挿入される。
- メソッドを呼び出すときには、レシーバが`self`になる。
- モジュール(あるいはクラス) を定義するときには、そのモジュールが`self`になる。
- インスタンス変数は常に`self`のインスタンス変数と見なされる。
- レシーバーを明示的に指定せずにメソッドを呼び出すと、`self`のメソッドだと見なされる。
- Refinementsはクラスコードにパッチを当てて、通常のメソッド探索をオーバライドするようなものである。ただし、Refinementsは`using`を呼び出したところから、ファイルやモジュールの定義が終わるところまでの限られた部分でのみ有効になる。
