---
layout: post
title:  "[Vue.js] HTMLとして出力したい"
date:   2019-05-08 10:00:00 +0900
categories: vue
---

「画面にHTMLタグを含む文字列を描画する際に、HTMLタグはHTMLとして出力する」みたいなことをするために色々調べたので、いくつか覚えておきたいことを書き付けとく。

## 事前知識として

Vue.js公式サイトの[テンプレート構文 > 展開](https://jp.vuejs.org/v2/guide/syntax.html#%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88)という項目で紹介されている通り、Vue.jsにおいてテキスト展開は変数を二重中括弧(`{{}}`)で囲うことで実現できる。

```html
<!-- colorには"Red"という文字列が格納されているとする -->
<!-- 画面には「Red」という文字列が出力される。 -->
<p>{{color}}</p>
```

また、この記法はもっとも基本的なデータバインディングの形でもあり、`color`プロパティの値が変更される度に出力内容が更新される。

ここまでが事前知識で、今回はこの`color`プロパティにHTMLタグを含んだ文字列を格納し、先にあげた「画面にHTMLタグを含む文字列を描画する際に、HTMLタグはHTMLとして出力する」を実現していく。

## 失敗談

まず初めは、単純に`color`にHTMLタグを含んだ文字列を格納し、それを二重中括弧記法で出力する。

```html
<!-- colorには"Red<br />Blue"という文字列が格納されているとする -->
<p>{{color}}</p>
```

ここで期待する結果は文字列に含まれる`<br />`タグがHTMLタグとして出力されることで、それは下記のようになること。

```
<期待する結果>
Red
Blue
```

だが、これの結果は次のようになる。

```
<実行の結果>
Red<br />Blue
```

## 解決方法とその理由について

上記の実行結果は見ての通り、`<br />`タグがプレーンテキストとして出力されてしまっている。

これについては、再びVue.js公式サイトの[テンプレート構文 > 生のHTML](https://jp.vuejs.org/v2/guide/syntax.html#%E7%94%9F%E3%81%AE-HTML)に解決策と理由が記載されていた。

>2重中括弧の mustaches は、データを HTML ではなく、プレーンなテキストとして扱います。実際の HTML として出力するためには、v-html ディレクティブを使用する必要があります

どうやら、二重中括弧記法ではプロパティの値をプレーンテキストとして出力するようになっていて、今回のようにHTMLとして出力したい場合は`v-html`ディレクティブを使う必要があるとのこと。

なので、今回は次のようにしてあげればHTMLとして出力できた。

```html
<!-- colorには"Red<br />Blue"という文字列が格納されているとする -->
<p v-html="color"></p>
```
```
<実行の結果>
Red
Blue
```

それで、なんで二重中括弧記法でのHTML出力を許可していないかについては次のように記載されていた。

> [XSS 脆弱性](https://en.wikipedia.org/wiki/Cross-site_scripting)を容易に引き起こすので、ウェブサイトで動的に任意のHTMLを描画することは、非常に危険です。信頼できるコンテンツにだけ HTML 展開を利用してください。ユーザーから提供されたコンテンツに対しては決して使用してはいけません。

「言われてみれば確かに。。。」ってなる内容なんだけど、熱が入りすぎて視野が狭まってた。
今回はその自戒も含めて記事として残せたかなという感じ。


## v-htmlでもfiltersを噛ませたい(おまけ)

二重中括弧記法でプロパティを出力する際に、[filters](https://jp.vuejs.org/v2/guide/filters.html)を使うことでデータを加工することができる。
二重中括弧記法でのfiltersの使い方は次のようになる。下記は配列の要素を`" and "`を挟んで結合し出力している。

```javascript
// arrには["Red", "Blue"]という配列が格納されているとする
{{arr | join}}

~省略~

filters: {
  join: function (value) {
    return value.join(" and ")
  }
}
```

```
<実行の結果>
Red and Blue
```

次に、この`" and "`ではなく`<br />`タグを挟んで結合したくなったとする。
この場合は二重中括弧記法でプロパティの展開を行うとHTMLタグがプレーンテキストとして、出力されてしまうので`v-html`ディレクティブを使う。
そこで気になるのが`v-html`における`filters`の指定方法で、それに関しては[この記事](https://stackoverflow.com/questions/41688899/vuejs2-v-html-with-filter)が参考になった。

```html
<!-- colorには"Red<br />Blue"という文字列が格納されているとする -->
<p v-html="$options.filters.json(color)"></p>
```

```javascript
filters: {
  join: function (value) {
    return value.join("<br />")
  }
}
```

```
<実行の結果>
Red
Blue
```

これで`v-html`でも`filters`を指定することができた。以上。
